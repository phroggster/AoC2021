using System;
using System.Collections.Generic;
using System.Diagnostics;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace AoC2021.Day05
{
  [DebuggerDisplay("{DbgView,nq}")]
  public readonly struct Point
  {
    public readonly ushort x;
    public readonly ushort y;

    public Point(ushort xpos, ushort ypos)
    {
      x = xpos;
      y = ypos;
    }


    /// <exception cref="OverflowException"/>
    public static Point operator +(Point lhs, Point rhs)
    {
      int dx = lhs.x + rhs.x;
      int dy = lhs.y + rhs.y;
      if (dx > ushort.MaxValue || dx < 0 || dy > ushort.MaxValue || dy < 0)
        throw new OverflowException();

      return new Point((ushort)dx, (ushort)dy);
    }

    /// <exception cref="OverflowException"/>
    public static Point operator -(Point lhs, Point rhs)
    {
      int dx = lhs.x - rhs.x;
      int dy = lhs.y - rhs.y;
      if (dx > ushort.MaxValue || dx < 0 || dy > ushort.MaxValue || dy < 0)
        throw new OverflowException();

      return new Point((ushort)dx, (ushort)dy);
    }


    internal string DbgView => $"{x},{y}";

    public override string ToString()
    {
      return $"{x},{y}";
    }
  }

  [DebuggerDisplay("{DbgView,nq}")]
  public readonly struct Line
  {
    public readonly Point a;
    public readonly Point b;

    public Line(ushort x1, ushort y1, ushort x2, ushort y2)
    {
      a = new Point(x1, y1);
      b = new Point(x2, y2);
    }

    public Line(Point pA, Point pB)
    {
      a = pA;
      b = pB;
    }


    public ushort X1 => a.x;
    public ushort Y1 => a.y;
    public ushort X2 => b.x;
    public ushort Y2 => b.y;

    public bool IsHorizontal => a.y == b.y;
    public bool IsVertical => a.x == b.x;

    internal string DbgView => $"{a.DbgView} -> {b.DbgView}";

    public ushort MaxX => Math.Max(a.x, b.x);
    public ushort MaxY => Math.Max(a.y, b.y);
    public ushort MinX => Math.Min(a.x, b.x);
    public ushort MinY => Math.Min(a.y, b.y);
  }

  public class Data
  {
    public static readonly Line[] ExampleDataDay05 =
    {
      new(0,9, 5,9),
      new(8,0, 0,8),
      new(9,4, 3,4),
      new(2,2, 2,1),
      new(7,0, 7,4),
      new(6,4, 2,0),
      new(0,9, 2,9),
      new(3,4, 1,4),
      new(0,0, 8,8),
      new(5,5, 8,2)
    };

    public static readonly Line[] ActualDataDay05 =
    {
      new(556,286, 341,71),
      new(337,201, 782,646),
      new(786,780, 117,111),
      new(977,864, 199,86),
      new(544,127, 544,144),
      new(539,471, 539,972),
      new(364,765, 364,285),
      new(282,325, 892,935),
      new(536,941, 158,941),
      new(280,39, 806,565),
      new(168,662, 363,857),
      new(639,676, 639,701),
      new(397,809, 466,809),
      new(716,118, 625,209),
      new(153,582, 497,926),
      new(35,706, 398,706),
      new(61,41, 519,41),
      new(158,557, 158,922),
      new(320,177, 624,481),
      new(800,779, 466,779),
      new(292,270, 292,497),
      new(919,17, 757,17),
      new(935,520, 935,688),
      new(948,480, 303,480),
      new(306,811, 306,467),
      new(227,582, 464,819),
      new(757,807, 757,688),
      new(983,12, 30,965),
      new(632,262, 640,262),
      new(755,314, 138,931),
      new(179,599, 179,144),
      new(556,246, 801,491),
      new(114,218, 114,60),
      new(183,70, 423,70),
      new(561,661, 231,331),
      new(875,738, 723,890),
      new(812,828, 812,78),
      new(98,707, 88,707),
      new(804,979, 188,979),
      new(503,178, 453,178),
      new(902,678, 248,678),
      new(603,618, 737,752),
      new(788,735, 559,964),
      new(839,134, 839,408),
      new(569,356, 491,356),
      new(566,543, 566,77),
      new(624,386, 111,386),
      new(781,109, 781,52),
      new(187,709, 23,545),
      new(220,123, 856,123),
      new(210,528, 398,716),
      new(942,935, 58,51),
      new(102,13, 102,560),
      new(926,588, 969,545),
      new(529,117, 146,117),
      new(989,211, 739,461),
      new(207,201, 207,106),
      new(799,876, 284,876),
      new(370,773, 687,456),
      new(571,972, 571,351),
      new(877,910, 877,12),
      new(384,205, 384,940),
      new(493,915, 912,496),
      new(764,412, 368,16),
      new(368,220, 333,220),
      new(526,271, 778,271),
      new(379,203, 417,165),
      new(168,577, 168,709),
      new(529,808, 598,739),
      new(959,506, 959,626),
      new(576,89, 863,89),
      new(277,412, 311,378),
      new(12,19, 975,982),
      new(620,951, 240,571),
      new(937,206, 954,206),
      new(231,177, 918,864),
      new(499,825, 315,825),
      new(289,876, 289,302),
      new(408,569, 46,207),
      new(461,838, 91,838),
      new(281,294, 281,737),
      new(61,541, 61,747),
      new(768,857, 768,276),
      new(782,97, 33,97),
      new(544,563, 251,856),
      new(731,216, 731,19),
      new(767,142, 242,667),
      new(469,612, 952,129),
      new(508,363, 508,540),
      new(614,845, 614,739),
      new(342,362, 235,362),
      new(880,703, 880,653),
      new(942,669, 651,669),
      new(884,976, 884,924),
      new(158,822, 945,35),
      new(510,716, 884,342),
      new(523,946, 73,496),
      new(334,430, 157,253),
      new(593,77, 105,565),
      new(269,132, 243,132),
      new(902,529, 180,529),
      new(554,767, 554,938),
      new(164,615, 425,615),
      new(51,713, 51,341),
      new(428,606, 89,945),
      new(600,402, 600,185),
      new(774,550, 774,207),
      new(465,204, 697,436),
      new(577,719, 255,719),
      new(647,990, 970,990),
      new(649,170, 886,407),
      new(428,503, 428,394),
      new(381,608, 381,444),
      new(778,175, 778,121),
      new(795,379, 379,379),
      new(929,792, 218,81),
      new(504,837, 504,449),
      new(212,216, 212,76),
      new(446,744, 446,116),
      new(824,247, 577,247),
      new(77,214, 553,214),
      new(913,234, 913,670),
      new(949,24, 43,930),
      new(733,758, 733,62),
      new(628,659, 962,659),
      new(172,749, 755,749),
      new(901,717, 184,717),
      new(457,578, 923,112),
      new(943,11, 912,11),
      new(728,597, 116,597),
      new(465,134, 465,159),
      new(170,953, 170,533),
      new(231,715, 231,219),
      new(209,187, 984,962),
      new(798,515, 798,601),
      new(479,123, 479,148),
      new(360,387, 360,356),
      new(962,818, 962,770),
      new(852,607, 852,886),
      new(159,838, 967,30),
      new(823,659, 642,478),
      new(374,893, 545,893),
      new(248,819, 248,978),
      new(894,473, 894,47),
      new(182,975, 278,879),
      new(75,248, 913,248),
      new(969,533, 969,827),
      new(18,40, 842,864),
      new(972,909, 220,157),
      new(378,159, 571,159),
      new(875,478, 238,478),
      new(95,807, 264,638),
      new(418,68, 418,387),
      new(784,548, 332,548),
      new(365,354, 365,836),
      new(731,615, 235,615),
      new(885,104, 513,476),
      new(816,47, 385,478),
      new(626,741, 626,499),
      new(371,372, 920,921),
      new(83,150, 922,989),
      new(623,520, 645,498),
      new(612,305, 561,305),
      new(845,149, 788,149),
      new(914,35, 829,35),
      new(143,165, 143,520),
      new(164,218, 266,218),
      new(118,644, 397,644),
      new(59,942, 970,31),
      new(616,774, 970,420),
      new(30,468, 874,468),
      new(454,208, 454,536),
      new(524,488, 524,931),
      new(54,479, 560,479),
      new(815,591, 815,813),
      new(959,971, 30,42),
      new(23,181, 149,181),
      new(841,294, 841,681),
      new(34,47, 367,47),
      new(913,590, 913,374),
      new(690,64, 690,672),
      new(541,112, 781,112),
      new(380,843, 687,536),
      new(303,330, 465,330),
      new(408,403, 326,403),
      new(352,962, 925,389),
      new(121,882, 873,130),
      new(979,294, 29,294),
      new(228,688, 228,738),
      new(845,930, 901,930),
      new(726,189, 27,888),
      new(223,888, 989,888),
      new(483,632, 483,321),
      new(606,810, 820,810),
      new(225,31, 225,342),
      new(841,18, 841,417),
      new(375,185, 375,413),
      new(641,189, 307,523),
      new(126,900, 126,990),
      new(530,220, 690,220),
      new(496,263, 154,263),
      new(140,503, 419,503),
      new(349,733, 349,819),
      new(43,29, 928,914),
      new(683,842, 683,489),
      new(113,634, 806,634),
      new(771,145, 130,145),
      new(88,467, 908,467),
      new(328,642, 328,795),
      new(986,191, 218,959),
      new(857,166, 857,594),
      new(950,763, 229,42),
      new(263,940, 101,940),
      new(689,182, 689,835),
      new(241,237, 733,237),
      new(965,150, 279,150),
      new(871,242, 474,639),
      new(688,947, 688,11),
      new(319,738, 945,112),
      new(21,853, 853,21),
      new(69,533, 69,741),
      new(492,981, 492,210),
      new(942,69, 249,69),
      new(63,364, 203,364),
      new(340,505, 15,505),
      new(41,43, 979,981),
      new(395,623, 217,801),
      new(540,37, 540,381),
      new(64,112, 882,930),
      new(887,212, 217,882),
      new(168,159, 108,159),
      new(117,22, 959,864),
      new(413,500, 413,616),
      new(775,597, 962,597),
      new(171,901, 143,901),
      new(777,391, 41,391),
      new(901,139, 70,970),
      new(215,75, 215,261),
      new(973,433, 786,433),
      new(757,568, 612,423),
      new(363,347, 185,525),
      new(274,363, 274,709),
      new(435,569, 880,569),
      new(267,297, 86,478),
      new(221,852, 985,88),
      new(322,560, 322,962),
      new(470,259, 470,508),
      new(861,860, 843,860),
      new(172,474, 172,714),
      new(53,839, 499,839),
      new(600,40, 600,227),
      new(820,952, 99,231),
      new(650,486, 586,486),
      new(305,273, 305,392),
      new(826,417, 826,92),
      new(309,934, 309,720),
      new(381,644, 381,623),
      new(38,78, 38,54),
      new(326,450, 173,450),
      new(474,100, 474,135),
      new(607,536, 192,121),
      new(686,504, 164,504),
      new(538,623, 429,623),
      new(200,385, 933,385),
      new(568,275, 31,275),
      new(105,201, 706,201),
      new(582,584, 827,584),
      new(24,469, 24,519),
      new(306,224, 32,224),
      new(429,528, 304,528),
      new(272,851, 272,927),
      new(636,113, 636,244),
      new(481,107, 783,107),
      new(834,87, 175,746),
      new(684,50, 61,673),
      new(30,335, 739,335),
      new(621,893, 266,893),
      new(968,942, 968,390),
      new(895,23, 136,23),
      new(742,650, 756,636),
      new(42,582, 368,582),
      new(890,266, 786,266),
      new(591,807, 921,807),
      new(915,333, 915,160),
      new(746,326, 826,326),
      new(663,803, 34,174),
      new(533,513, 692,513),
      new(205,133, 935,133),
      new(730,138, 58,810),
      new(290,87, 290,488),
      new(693,513, 693,323),
      new(188,491, 188,587),
      new(562,593, 562,122),
      new(629,457, 629,299),
      new(132,781, 381,781),
      new(356,965, 356,899),
      new(720,715, 487,715),
      new(356,120, 954,120),
      new(657,507, 323,173),
      new(13,190, 742,190),
      new(677,640, 491,640),
      new(145,605, 366,605),
      new(143,683, 681,145),
      new(700,787, 557,787),
      new(958,406, 212,406),
      new(267,734, 705,734),
      new(470,333, 257,120),
      new(790,656, 523,389),
      new(13,904, 898,19),
      new(29,970, 961,38),
      new(846,454, 846,153),
      new(564,488, 98,488),
      new(904,19, 60,863),
      new(493,112, 472,133),
      new(945,977, 141,173),
      new(720,231, 720,367),
      new(783,133, 783,422),
      new(165,754, 165,604),
      new(752,308, 715,271),
      new(413,969, 431,951),
      new(833,437, 833,881),
      new(612,802, 612,64),
      new(974,187, 543,618),
      new(655,183, 675,183),
      new(696,833, 906,623),
      new(756,792, 756,741),
      new(338,140, 878,680),
      new(854,955, 241,342),
      new(602,466, 326,466),
      new(470,125, 464,131),
      new(568,141, 43,666),
      new(826,318, 783,275),
      new(194,986, 194,466),
      new(896,330, 621,55),
      new(482,709, 704,931),
      new(345,912, 345,741),
      new(758,119, 758,841),
      new(11,777, 11,249),
      new(88,945, 795,945),
      new(665,74, 124,615),
      new(243,831, 249,837),
      new(40,69, 720,749),
      new(757,804, 757,900),
      new(803,265, 336,732),
      new(299,155, 758,614),
      new(787,173, 172,788),
      new(251,400, 251,168),
      new(217,480, 486,480),
      new(939,974, 21,56),
      new(767,649, 378,649),
      new(197,764, 561,400),
      new(767,577, 579,577),
      new(952,982, 28,58),
      new(282,527, 282,640),
      new(944,125, 184,125),
      new(149,848, 351,848),
      new(36,437, 350,437),
      new(63,527, 764,527),
      new(66,313, 302,549),
      new(805,485, 577,485),
      new(660,626, 903,626),
      new(927,542, 897,542),
      new(577,344, 577,934),
      new(624,284, 624,497),
      new(649,618, 153,122),
      new(942,32, 227,747),
      new(10,190, 10,629),
      new(84,638, 470,252),
      new(362,89, 362,762),
      new(351,844, 916,279),
      new(683,561, 497,747),
      new(628,473, 103,473),
      new(319,525, 782,62),
      new(842,131, 551,131),
      new(980,960, 51,31),
      new(662,12, 666,12),
      new(337,814, 337,736),
      new(720,99, 760,99),
      new(867,515, 867,650),
      new(248,872, 142,872),
      new(295,274, 298,274),
      new(102,369, 102,648),
      new(523,142, 54,611),
      new(369,798, 978,189),
      new(215,688, 835,688),
      new(846,242, 786,182),
      new(68,923, 68,342),
      new(690,416, 559,547),
      new(567,134, 278,134),
      new(89,126, 846,883),
      new(779,325, 389,325),
      new(675,461, 675,622),
      new(278,925, 953,250),
      new(907,460, 519,848),
      new(769,60, 592,60),
      new(331,103, 331,49),
      new(148,366, 148,516),
      new(933,52, 332,52),
      new(488,642, 488,523),
      new(632,403, 83,952),
      new(321,840, 756,405),
      new(302,627, 907,22),
      new(650,449, 650,553),
      new(219,466, 219,297),
      new(841,947, 78,184),
      new(40,746, 712,74),
      new(559,306, 895,306),
      new(317,592, 317,275),
      new(267,183, 267,428),
      new(43,397, 43,359),
      new(952,705, 952,634),
      new(921,837, 258,174),
      new(634,783, 656,805),
      new(366,309, 224,309),
      new(383,470, 526,613),
      new(717,419, 717,332),
      new(543,752, 543,500),
      new(954,892, 101,39),
      new(294,379, 583,379),
      new(829,388, 829,491),
      new(748,509, 283,509),
      new(347,75, 467,195),
      new(618,958, 371,711),
      new(986,827, 213,54),
      new(34,617, 982,617),
      new(716,902, 716,429),
      new(970,52, 107,915),
      new(563,33, 563,680),
      new(803,82, 136,749),
      new(24,968, 273,968),
      new(816,483, 620,287),
      new(783,588, 623,588),
      new(397,210, 988,801),
      new(911,387, 911,446),
      new(770,730, 786,730),
      new(22,11, 982,971),
      new(395,316, 151,316),
      new(301,420, 301,248),
      new(10,10, 989,989),
      new(637,358, 247,358),
      new(932,341, 642,341),
      new(162,594, 162,448),
      new(51,946, 396,946),
      new(591,253, 958,620),
      new(567,849, 567,713),
      new(879,910, 879,603),
      new(889,642, 437,642),
      new(669,528, 945,252),
      new(644,237, 774,237),
      new(488,870, 738,620),
      new(692,388, 959,388),
      new(506,17, 701,17),
      new(663,514, 663,216),
      new(684,862, 289,862),
      new(511,235, 519,227),
      new(866,940, 153,227),
      new(381,518, 87,518),
      new(837,573, 181,573),
      new(337,191, 337,135),
      new(324,573, 945,573),
      new(449,800, 390,741),
      new(763,378, 763,695),
      new(24,457, 444,877),
      new(267,875, 798,344),
      new(724,848, 395,848),
      new(931,322, 931,244),
      new(426,241, 280,241),
      new(175,879, 175,883),
      new(496,158, 560,158),
      new(899,319, 805,319),
      new(799,424, 563,188),
      new(958,388, 958,290),
      new(558,95, 314,95),
      new(768,646, 961,839),
      new(246,534, 246,147),
      new(808,720, 808,385),
      new(912,147, 912,305),
      new(670,676, 776,676),
      new(534,594, 696,594),
      new(736,768, 736,364),
      new(377,784, 377,368),
      new(799,105, 978,284),
      new(763,575, 763,253),
      new(581,205, 581,45),
      new(932,782, 678,782),
      new(400,950, 936,414),
      new(68,616, 897,616),
      new(399,662, 291,554),
      new(354,397, 354,489),
      new(219,276, 862,919),
      new(115,138, 195,138),
      new(863,326, 863,335),
      new(884,130, 271,743),
      new(986,148, 234,900),
      new(254,186, 973,905),
      new(975,971, 672,971),
      new(122,533, 19,636),
      new(316,512, 219,609),
      new(113,480, 716,480),
      new(483,540, 845,178)
    };
  }
}
